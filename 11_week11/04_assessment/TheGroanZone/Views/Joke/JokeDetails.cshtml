@model JokeViewModel

@{
    ViewData["Title"] = "Joke Details";
    var joke = Model;
}

<section class="d-flex gap-3">
    <div class="" style="flex: 2">
        <div class="card shadow">
            <div class="card-body">
                <h1>Joke Details</h1>
                <div class="mb-3">
                    <p><strong>Setup: </strong>@joke.Setup</p>
                </div>
                <div>
                    <p><strong>Punchline: </strong>@joke.Punchline</p>
                </div>
            </div>
            @if(joke.UserId == Context.Session.GetInt32("userId")){
            <div class="card-footer text-muted justify-content-end gap-2 d-flex">
                <a href="/jokes/@joke.Id/edit">edit</a>
                <a href="/jokes/@joke.Id/delete">delete</a>
            </div>
            }
        </div>
    </div>
    <div class="d-flex gap-3 flex-column" style="flex: 1">
        <div class="card shadow p-3" style="flex: 1">
            <h2>Stats</h2>
            @if(joke.TotalRatings == 0){
                <p><strong>No ratings found.</strong> Why not give this joke it's first rating down below?</p>
            }
            else{
            <ul class="list-unstyled">
                <li><strong>Ratings:</strong> @joke.TotalRatings</li>
                <li><strong>Average rating:</strong> @joke.AvgRating</li>
                <li>
                    Rated By:
                    <ul>
                        @foreach(var username in joke.UsersThatHaveRated){
                            <li>@username</li>
                        }    
                    </ul>
                </li>
            </ul>
            }
        </div>
        <div class="card shadow p-3" style="flex: 1">
            <h2>Rate this joke:</h2>
            <form asp-action="AddRating" asp-controller="Joke" method="post" asp-route-jokeId="@joke.Id" class="mb-3">
                <div class="mb-3">
                    <select name="rating" id="rating">
                        <option disabled selected="@(joke.UserRating == null)" value="0"> -- Select groan amount -- </option>
                        @for(int i = 1; i <= 4; i++){
                            <option value="@i" selected="@(joke.UserRating == i)">@i</option>
                        }
                    </select>
                    @* <span asp-validation-for="Setup" class="form-text text-danger"></span> *@
                </div>
                <div class="text-end">
                    <button type="submit" class="btn btn-primary">Rate</button>
                </div>
            </form>
        </div>
    </div>
</section>